# 决策记录

## 决策记录格式

每次重要决策请按照以下格式记录：

### YYYY-MM-DD HH:MM:SS

**决策的背景**：描述当时的情况和问题
**决策的内容**：具体的决策事项
**决策的原因**：为什么做出这个决策
**决策的结果**：决策实施后的效果

---

## 决策记录

### 2026-02-03 16:30:00

**决策的背景**：用户在 Linux 服务器上执行 `docker compose up -d` 时出现报错，需要分析原因并提供解决方案
**决策的内容**：
1. 将 MySQL 初始化脚本从 Python 脚本改为 SQL 脚本
2. 修复前端 Dockerfile 中的 npm 安装问题
3. 简化 Nginx 用户权限配置
**决策的原因**：
1. MySQL 官方镜像的 `/docker-entrypoint-initdb.d/` 只支持 `.sh`、`.sql`、`.sql.gz` 格式，Python 脚本无法被执行，这是导致数据库表无法自动创建的主要原因
2. 项目没有 `package-lock.json` 文件，使用 `npm ci` 会失败，需要改用 `npm install`
3. Nginx 使用非 root 用户可能导致权限问题，简化配置以提高兼容性
**决策的结果**：
- 创建了 `scripts/init_db.sql` 文件，包含完整的数据库表结构
- 更新了 `docker-compose.yml` 使用新的 SQL 初始化脚本
- 修复了前端 Dockerfile，使其能在没有 package-lock.json 的情况下正常构建
- 简化了 Nginx 配置，移除了可能导致权限问题的非 root 用户设置

### 2026-02-04 09:43:26

**决策的背景**：需要为系统新增登录与用户管理模块，同时避免与现有后端 API 响应风格产生割裂，降低联调与迁移成本
**决策的内容**：后端沿用现有接口风格：成功响应直接返回业务数据；失败响应使用HTTP状态码表达语义并通过detail返回错误信息；前端通过Axios拦截器与路由守卫实现鉴权闭环
**决策的原因**：
1. 现有 endpoints 已广泛使用“成功直返业务数据 + HTTPException(detail)”模式，强行切换统一包装会引入大范围改动与兼容成本
2. 保持HTTP状态码语义有利于错误处理、监控统计与标准化客户端行为
3. 鉴权逻辑集中在拦截器/守卫可减少页面重复代码并提升一致性
**决策的结果**：形成并新增《登录与用户管理模块实施方案（gpt-5.2）》文档，明确接口形状与前后端接入方式，作为后续实现的依据

### 2026-02-04 10:00:00

**决策的背景**：根据实施方案全面开发登录与用户管理模块，需要做出多个技术决策
**决策的内容**：
1. Token存储方案：使用localStorage存储JWT Token
2. 密码加密方案：使用bcrypt进行密码哈希，限制密码长度不超过72字节
3. 验证码方案：使用PIL生成图形验证码，4位数字+字母，5分钟有效期，一次性使用
4. 登录安全策略：连续5次失败锁定15分钟
5. 权限模型：RBAC最小集，admin和user两个角色
6. 后端接口风格：沿用现有风格，成功直接返回数据，失败使用HTTP状态码+detail
**决策的原因**：
1. localStorage适合与现有项目轻量接入，后续可迭代更安全的方案
2. bcrypt是业界标准，72字节限制是bcrypt算法的安全限制
3. 图形验证码简单有效，4位长度兼顾安全性和用户体验
4. 5次失败+15分钟锁定是业界常见的防暴力破解策略
5. RBAC最小集满足当前需求，后续可扩展更细粒度权限
6. 沿用现有风格保持代码一致性，降低集成成本
**决策的结果**：
- 完成后端认证模块（验证码、登录、登出、用户信息）
- 完成用户管理API（列表、创建、编辑、删除、重置密码）
- 完成个人中心API（查看、修改资料、修改密码）
- 完成前端登录页面、用户管理页面、个人中心页面
- 完成路由守卫和Axios拦截器实现鉴权闭环
- 创建初始化脚本生成默认管理员账号（admin/admin123）
